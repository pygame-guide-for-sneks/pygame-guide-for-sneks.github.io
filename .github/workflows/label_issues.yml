on: [pull_request, pull_request_review]
name: Label approved pull requests

env:
  GITHUB_TOKEN: ${{ secrets.LABEL_SECRET }}

jobs:
  labelWhenApproved:
    name: Label when approved
    runs-on: ubuntu-latest

    permissions:
      contents: read
      issues: write
      pull-requests: write

    steps:
    - name: Label no reviews
      uses: pullreminders/label-when-approved-action@master
      env:
        APPROVALS: "0"
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        ADD_LABEL: "PR%3A%A0Needs%A0first%A0approval"
    - name: Label when one review
      uses: pullreminders/label-when-approved-action@master
      env:
        APPROVALS: "1"
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        ADD_LABEL: "PR%3A%A0Needs%A0second%A0approval"
        REMOVE_LABEL: "PR%3A%A0Needs%A0first%A0approval"
    - name: Label when two reviews
      uses: pullreminders/label-when-approved-action@master
      env:
        APPROVALS: "2"
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        ADD_LABEL: "PR%3A%A0Awaiting merge"
        REMOVE_LABEL: "PR%3A%A0Needs%A0second%A0approval"
